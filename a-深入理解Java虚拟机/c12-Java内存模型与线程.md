## Java内存模型

##### 主内存与工作内存

线程的工作内存保存了该线程使用到的变量的主内存的副本拷贝，线程对变量的操作都在工作内存中进行，而不能直接读写主内存中的变量。

> 主内存存变量：实例字段、静态字段和构成数组对象的元素
>
> 工作内存：成员变量、参数、主内存副本

##### 内存间交互操作

lock操作会清空工作内存中的值

> lock（锁定）：作用于主内存的变量，标识为线程独占
>
> unlock（解锁）：作用于主内存的变量，释放一个锁定状态的变量
>
> read（读取）：作用于主内存的变量，把一个变量的值从主内存传输到线程的工作内存
>
> load（载入）：作用于工作内存的变量，把主内存的变量值放入工作内存的变量副本中
>
> use（使用）：作用于工作内存的变量，把工作内存变量传递给执行引擎
>
> assign（赋值）：作用于工作内存的变量，把执行引擎接收到的值给工作内存
>
> store（存储）：作用于工作内存变量，把工作内存值传送到主内存
>
> write（写入）：作用于主内存的变量，把值存入主内存

##### 对于volatile型变量的特殊规则

> 保证此变量对所有线程的可见性：[read（读取）、load（载入）、use（使用）]关联，[assign（赋值）、store（存储）、write（存储）]关联，常用于变量原子操作n=m+1这种情况，但是n++会失效，比如两个线程获取了n，然后会写错误。
>
> 禁止指令重排序：禁止后面一行指令排到前面

##### 对long和double型变量的特殊规则

##### 原子性、可见性与有序性

##### 先行发生原则

## 线程安全与锁优化

##### 线程的实现

##### java线程调度

##### 状态转换

![](https://github.com/xuxh0622/booklist/blob/master/z-image/ac.png)